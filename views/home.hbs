<!DOCTYPE html>
<html lang="en">

<head>
    <script src="jquery.min.js"> </script>
    <link rel="stylesheet" type="text/css" href="/home.css">
</head>
<!--<script>const handleBar = require('handlebars')</script>-->
<body>
    <!--Side Navigation-->
    <div class="sidenav">
        <ul>
            <form action="home" method="GET">
                <input class="selection" type="submit" value="View All">
            </form>
            <form action="notes" method="GET">
                <input class="selection" type="submit" value="Notes">
            </form>
            <form action="checklists" method="GET">
                <input class="selection" type="submit" value="Checklists">
            </form>
        </ul>
        <div class="tagheader">TAGS
            <input class="addtagButton" type="button" value="ADD">
        </div>
        
        <ul id="tags_container">
            <form id="tags_list">
                {{#each tags}}
                    <input id="tag" class="selection" type="text" value="{{tags}}">
                {{/each}}
            </form>
        </ul>
    </div>

    <!--Header-->
    <div class="header sticky" id="HeaderDiv">
        <form action="logout" method="POST" id="logoutform">
            <input type="submit" value="Sign out" id="logout">
        </form>
        <h2 class="name">CheckNotes</h2>
        
        <form class="searchForm" method="GET">
            <input id="search_input" class="searchBar" type="text" placeholder="Search">
        </form>
        
        <!--<img class="logoutIcon" src="Checkbox Icon.svg">-->
    </div>

    <!--Page Content-->


    <div id="content">

        <!--<form class="createpostForm" method="post" action="create_post">
            <input id="postinput" type="text" placeholder="Create a note or checklist...">
            <input class="createpostButton" id="notebutton"type="button" value="NOTE" >
            <input class="createpostButton" id="listbutton" type="button" value="CHECKLIST">
            <input class="createpostButton" id="picbutton" type="button" value="IMAGE">
            <input id='fileid' type='file' accept=".jpg" style="display: none">
        </form>-->

        <div id="notescontainer">
            {{#each notes}}
                <div class="noteDiv" data-id="{{_id}}">
                    {{#if images}}
                        <div></div>
                    {{/if}}
                    <p class="noteTitle">{{title}}</p>
                    <div class = "noteTagDiv">
                        {{#each tags}}
                            <span id="noteTag">{{tags}}</span>
                        {{/each}}
                    </div>
                    {{#if note}}
                        <p class="noteContent">{{note}}</p>
                    {{/if}}
                    {{#if checklist}}
                        {{#each checklist}}
                            <div class="item_container">
                            <input type="checkbox" checked="{{status}}"><span class="task">{{task}}</span>
                            </div>
                        {{/each}}
                    {{/if}}
                </div>
            {{/each}}

            <div id = "createPost">
                <div id="addbutton">
                    +
                </div>
            </div>
            <!--<div class="checklistDiv">
                <p class="checklistTitle">Upcoming Schoolwork</p>
                <form class="checklistButtons">
                    <input class="editCheckList" type="button" value="EDIT"><br>
                    <input class="deleteCheckList" type="button" value="DELETE">
                </form>
                <form class="checklistContent">
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">HCIFACE DJ4 - August 5</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">WEBAPDE Phase 2 - August 6</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">INTR-OS miniP2 - August 7</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">AUTOMAT Problem Set 4 - August 8</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">WEBPAPDE Mini Challenge 5 - August 8</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">INTR-OS Exam - August 9</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">HCIFACE Exam - August 9</label><br>
                    <label class="checklistItem" name="p_id[]"><input type="checkbox">SOCTEC2 Presentation - August 9</label><br>
                </form>

                <div class="checklistTagDiv">
                    <span id="checklistTag">School</span>
                </div>
            </div>-->
        </div>
    </div>

    <!--Overlay
    <div id="overlay">
        <div id="background"></div>
        <div id="newpost">
        </div>
    </div>

    <div id="overlay_editN">
        <div id="background_editN"></div>
        <div id="editpost">
        </div>
    </div>

    <div id="overlay_editCL">
        <div id="background_editCL"></div>
        <div id="editCL">
        </div>
    </div>-->

    <!-- The Modal -->
    <div id="addModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <div class="tab">
                <button class="tablinks" id="defaultOpen" onclick="tabClick(event, 'createNote')">NOTE</button>
                <button class="tablinks" onclick="tabClick(event, 'createChecklist')">CHECKLIST</button>
            </div>
            <div class="modal-body">
                <img class="post_image" src="#" style="display:none"/>
                <input class="post_title" type="text" placeholder="Enter Title...">
                <div class="tabcontent" id="createNote">
                    <label>
                        <textarea class="noteInput" placeholder="Enter Content..." id="note_content"></textarea>
                    </label>
                    <button id="picbutton">UPLOAD IMAGE</button>
                    <input id='fileid' type='file' accept=".jpg" style="display: none">
                </div>
                <div class="tabcontent" id="createChecklist">
                    <div class="item_container">
                        <input type="checkbox" class="list_check">
                        <input type="text" class="list_task" placeholder="Enter task...">
                        <span class="remove">REMOVE</span>
                    </div>
                    <button class="add">+</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="createbutton">SAVE</button>
                <button id="noteTag">+</button>
            </div>
            <form action="/content/createnotes" method="post" id="addNote">
                <input type="hidden" id="formtitle" name="note_title">
                <input type="hidden" id="formcontent" name ="note_content">
                <input type="hidden" id="formimage" name="note_image">
            </form>
        </div>

    </div>

    <div id="editModal" class="modal">
        <div class="modal-content edit">
            <div class="modal-body note">
                <img class="post_image" src="#" style="display:none"/>
                <input class="post_title" type="text">
                <div class="editcontent" id="editNote">
                    <label>
                        <textarea class="noteInput" id="note_content"></textarea>
                    </label>
                    <button id="picbutton">UPLOAD IMAGE</button>
                    <input id='fileid' type='file' accept=".jpg" style="display: none">
                </div>
                <div class="editcontent" id="editChecklist">

                </div>
            </div>

            <div class="modal-footer">
                <button id="savebutton">SAVE</button>
                <button id="noteTag">+</button>
            </div>
            <form action="/content/editnote" method="post" id="editNote">
                <input type="hidden" id="editnoteid"  name="note_id">
                <input type="hidden" id="editformtitle" name="note_title">
                <input type="hidden" id="editformcontent" name ="note_content">
                <input type="hidden" id="editformimage" name="note_image">
            </form>
        </div>
    </div>
    <script>
        $(document).ready(()=> {
            // Get the modal
            var addModal = document.getElementById("addModal");
            let editModal = document.getElementById("editModal");
            var fileName = "";
            $("#createPost").click(function(){
                $("#addModal").css("display","block");
                $("#defaultOpen").click();
            });
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                if (event.target == addModal) {
                    addModal.style.display = "none";
                    $(".list_task").val("");
                    $(".noteInput").val("");
                    $(".post_title").val("");
                }
                else if(event.target == editModal){
                    editModal.style.display = "none"
                }
            }


            $(".tablinks").click(function(){
                $(this).parent().find(".active").removeClass("active");
                $(this).addClass("active");
            });

            $("#picbutton").click(function () {
                document.getElementById("fileid").click();
            })

            $(".add").click(function() {
                let item_input = document.createElement("input");
                item_input.type ="text";
                item_input.className = "list_task";
                $(item_input).attr("placeholder","Enter task...");

                let checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.className = "list_check";

                let remove = document.createElement("span");
                remove.innerHTML ="REMOVE";
                remove.className = "remove";

                let divCtnr = document.createElement("div");
                divCtnr.className ="item_container";
                divCtnr.append(checkbox);
                divCtnr.append(item_input);
                divCtnr.append(remove);

                $(divCtnr).insertBefore(this);
                return false;
            });


            $("#createbutton").click(function () {
                $("#formtitle").val($(".post_title").val())
                $("#formcontent").val($(".noteInput").val())
                $("#formimage").val($("#fileid").files[0].name);
                $(".list_task").each(function () {
                    let task = document.createElement("input");
                    task.type = "hidden";
                    task.name = "listitem[]";
                    $(task).val($(this).val());
                    $("#addNote").append(task);
                });
                $(".list_check").each(function () {
                    let checkbox = document.createElement("input");
                    checkbox.type = "hidden";
                    checkbox.name = "listcheckboxes[]";
                    $(checkbox).val($(this).val());
                    $("#addNote").append(checkbox);
                });
                $("#addNote").submit();
            })

            $("#noteTag").click(function() {
                let newTag = document.createElement("input");
                newTag.type = "text";
                $(newTag).val($(this).val());
                newTag.className = "newTag";

                /*$(".newTag").change(function() {
                    $(this).css("border-radius", "25px");
                    console.log("changed");
                })*/

                $(".modal-footer").append(newTag);

                $(".modal-footer").submit();
            });


        })

            $(".noteDiv").click(function () {
                let noteid = $(this).attr("data-id");
                $.ajax({
                    id: noteid,
                    url:"/content/"+noteid,
                    method:"get",
                    data:[

                    ],
                    success: function(res){
                        $(editModal).css("display","block");
                        console.log(res.title);
                        $(editModal).find(".post_title").val(res.title);
                        if(res.note!== "") {
                            $("#editNote").css("display", "block");
                            $(editModal).find(".noteContent").val(res.note);
                        }
                        /*if(res.checklist!==null) {
                            $("#editChecklist").css("display", "block");
                            for (checklists in checklist) {
                                let item_input = document.createElement("input");
                                item_input.type = "text";
                                item_input.className = "list_task";
                                $(item_input).attr("placeholder", "Enter task...");

                                let checkbox = document.createElement("input");
                                checkbox.type = "checkbox";
                                checkbox.className = "list_check";

                                let remove = document.createElement("span");
                                remove.innerHTML = "REMOVE";
                                remove.className = "remove";

                                let divCtnr = document.createElement("div");
                                divCtnr.className = "item_container";
                                divCtnr.append(checkbox);
                                divCtnr.append(item_input);
                                divCtnr.append(remove);

                                $("#editChecklist").append(item_input);
                            }
                        }*/
                    }
                })
            })

            function editNote(note){

                $(editModal).css("display","block");
                let title = $(editModal).find(".post_title");
                let content = $(editModal).find(".noteInput");
                title.val($(note).find(".noteTitle").text());
                content.val($(note).find(".noteContent").text());
            }

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $(input).parent().parent().find('.post_image').css("display","block");
                    $(input).parent().parent().find('.post_image').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#fileid").change(function(){
            readURL(this);
        });

        function tabClick(event, tabName) {
            // Declare all variables
            let i, tabcontent, tablinks;

            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            if(tabName==="createNote")
                $(".list_task").val("");
            else if(tabName==="createChecklist")
                $(".noteInput").val("");

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            event.currentTarget.className += " active";
        }


    </script>
</body>

</html>